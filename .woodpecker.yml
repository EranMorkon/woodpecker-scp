steps:
  publish:
    image: woodpeckerci/plugin-docker-buildx
    settings:
      repo: git.merp.digital/${CI_REPO_OWNER}/woodpecker-scp
      platforms: windows/amd64,darwin/amd64,darwin/arm64,freebsd/amd64,linux/amd64,linux/arm64/v8
      registry: git.merp.digital
      tags: ${CI_COMMIT_BRANCH}
      username: ${CI_REPO_OWNER}
      password:
        from_secret: cb_token

  publish-release:
    image: woodpeckerci/plugin-docker-buildx
    settings:
      repo: git.merp.digital/${CI_REPO_OWNER}/woodpecker-scp
      platforms: windows/amd64,darwin/amd64,darwin/arm64,freebsd/amd64,linux/amd64,linux/arm64/v8
      registry: git.merp.digital
      tags:
        - latest
        - ${CI_COMMIT_TAG}
      username: ${CI_REPO_OWNER}
      password:
        from_secret: cb_token
    when:
      - event: tag